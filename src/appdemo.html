<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Notes :: XP.LIVE</title>
  <script type="module">
    import App from "./components/app.js";
    import Profile from "./components/profile.js";
    import Notes from "./components/notes.js";
    import Relays from "./components/relays.js";
    import NIP_19 from "./components/nip19.js";
    import SaveStorage from "./components/saveStorage.js";

    globalThis.addEventListener("alpine:init", () => {
      Profile();
      Notes();
      Relays();
      NIP_19();
      SaveStorage();
      App();
    });
  </script>
  <script src="https://unpkg.com/alpinejs" defer></script>
  <style>
    label {
      display: block;
    }

    [role="listitem"] label {
      display: inline-block;
    }
  </style>
</head>

<body>
  <div x-data="saveStorage">
    <button type="button" @click="onExport">
      export settings
    </button>
    <button type="button" @click="onImport">
      import settings
    </button>
  </div>

  <div x-data="appcreate">
    <div>
      <input x-model="name" type="text" placeholder="name">
    </div>
    <div>
      <textarea x-model="data" cols="30" rows="10"></textarea>
    </div>
    <div>
      <select x-model="contentType">
        <option value="text/html">HTML</option>
        <option value="text/css">CSS</option>
        <option value="application/javascript">JavaScript</option>
      </select>
    </div>
    <button type="button" @click="onCreate">
      deploy
    </button>
  </div>

  <div x-data="appshow">
    <ul>
      <template x-for="app in appdata">
        <li>
          <button type="button" @click="onShow(app.event)">
            <b x-text="app.identifier"></b>
            (<span x-text="app.name"></span>)
          </button>
          <button type="button" @click="onEdit(app.event)">
            edit
          </button>
          <button x-data="appdelete" type="button" @click="onDelete(app.event, 'Deleted by App owner')">
            delete
          </button>
        </li>
      </template>
      <template x-if="!apps || apps.length === 0">
        <li>
          <span>no apps</span>
        </li>
      </template>
    </ul>

    <iframe x-ref="iframe" src="about:blank" frameborder="0" csp="frame-src 'self'"
      sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
  </div>

  <ul x-data="relays">
    <template x-for="([relay, options]) in Array.from(relays)">
      <li>
        <del x-show="!options.read && !options.write" x-text="relay"></del>
        <b x-show="options.read || options.write" x-text="relay"></b>
        <span x-show="options.read">readable</span>
        <span x-show="options.write">writable</span>
      </li>
    </template>
  </ul>
</body>

</html>